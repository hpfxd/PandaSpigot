From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: uRyanxD <familiarodrigues123ro@gmail.com>
Date: Thu, 4 May 2023 14:27:42 -0300
Subject: [PATCH] Fix Paper mistakes

* https://github.com/PaperMC/Paper/commit/9dffc43aec635a6b44cf43cb07b118044d768cd1
* https://github.com/PaperMC/Paper/commit/cf65e06d966649fa53f3b6b70bca3c157cf3c9a4

diff --git a/src/main/java/net/minecraft/server/Chunk.java b/src/main/java/net/minecraft/server/Chunk.java
index 9c22cf970288d24a431df836409fc8026dee2384..3cb8d99311e2fa9a4a1173f6ef9e8dee957b20fa 100644
--- a/src/main/java/net/minecraft/server/Chunk.java
+++ b/src/main/java/net/minecraft/server/Chunk.java
@@ -1034,7 +1034,7 @@ public class Chunk {
 
         // PaperSpigot start
         int[] counts;
-        if (ItemStack.class.isAssignableFrom(oclass)) {
+        if (EntityItem.class.isAssignableFrom(oclass)) { // PandaSpigot
             counts = itemCounts;
         } else if (IInventory.class.isAssignableFrom(oclass)) {
             counts = inventoryEntityCounts;
diff --git a/src/main/java/net/minecraft/server/EntityFallingBlock.java b/src/main/java/net/minecraft/server/EntityFallingBlock.java
index 36c384eb9c2280e618eac770ce67ad0abfd7dc88..4ed27bf9a31d06cc5d06d04cd3e46e91004eef35 100644
--- a/src/main/java/net/minecraft/server/EntityFallingBlock.java
+++ b/src/main/java/net/minecraft/server/EntityFallingBlock.java
@@ -93,7 +93,7 @@ public class EntityFallingBlock extends Entity {
 
             // PaperSpigot start - Drop falling blocks above the specified height
             if (this.world.paperSpigotConfig.fallingBlockHeightNerf != 0 && this.locY > this.world.paperSpigotConfig.fallingBlockHeightNerf) {
-                if (this.dropItem) {
+                if (this.dropItem && this.world.getGameRules().getBoolean("doEntityDrops")) { // PandaSpigot
                     this.a(new ItemStack(block, 1, block.getDropData(this.block)), 0.0F);
                 }
 
