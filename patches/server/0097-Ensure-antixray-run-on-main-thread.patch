From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: uRyanxD <familiarodrigues123ro@gmail.com>
Date: Thu, 4 May 2023 14:10:37 -0300
Subject: [PATCH] Ensure antixray run on main thread


diff --git a/src/main/java/net/minecraft/server/PacketPlayOutMapChunkBulk.java b/src/main/java/net/minecraft/server/PacketPlayOutMapChunkBulk.java
index 00c05385066dc2dafad5fd2fc891295cd65bc2df..b4350b552b1435af4fbb9d213c17e877eb178236 100644
--- a/src/main/java/net/minecraft/server/PacketPlayOutMapChunkBulk.java
+++ b/src/main/java/net/minecraft/server/PacketPlayOutMapChunkBulk.java
@@ -70,7 +70,11 @@ public class PacketPlayOutMapChunkBulk implements Packet<PacketListenerPlayOut>
         }
 
         for (i = 0; i < this.a.length; ++i) {
+            // PandaSpigot start
+            if (MinecraftServer.getServer().isMainThread()) {
             world.spigotConfig.antiXrayInstance.obfuscate(this.a[i], this.b[i], this.c[i].b, this.c[i].a, world); // Spigot
+            }
+            // PandaSpigot end
             packetdataserializer.writeBytes(this.c[i].a);
         }
 
