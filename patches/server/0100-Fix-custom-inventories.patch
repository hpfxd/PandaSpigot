From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: uRyanxD <familiarodrigues123ro@gmail.com>
Date: Sun, 4 Feb 2024 19:16:54 -0300
Subject: [PATCH] Fix custom inventories

TODO: Finish the setupHorse() method and test it

diff --git a/src/main/java/org/bukkit/craftbukkit/inventory/CraftContainer.java b/src/main/java/org/bukkit/craftbukkit/inventory/CraftContainer.java
index 1dbc588e72111afebbcfc3b1d714b7f24d6d42fe..ad98a8f599f616d2c8a203fff1fb6c811c33cddf 100644
--- a/src/main/java/org/bukkit/craftbukkit/inventory/CraftContainer.java
+++ b/src/main/java/org/bukkit/craftbukkit/inventory/CraftContainer.java
@@ -110,6 +110,12 @@ public class CraftContainer extends Container {
             return "minecraft:anvil";
         case HOPPER:
             return "minecraft:hopper";
+        // PandaSpigot start - Fix custom inventories
+        case MERCHANT:
+            return "minecraft:merchant";
+        case HORSE:
+            return "minecraft:horse";
+        // PandaSpigot end
         default:
             return "minecraft:chest";
         }
@@ -139,9 +145,25 @@ public class CraftContainer extends Container {
         case BREWING:
             setupBrewing(top, bottom);
             break;
+        // PandaSpigot start - Fix custom inventories
+        case BEACON:
+            setupBeacon(top, bottom);
+            break;
+        case ANVIL:
+            setupAnvil(top, bottom);
+            break;
+        // PandaSpigot end
         case HOPPER:
             setupHopper(top, bottom);
             break;
+        // PandaSpigot start - Fix custom inventories
+        case MERCHANT:
+            setupMerchant(top, bottom);
+            break;
+        case HORSE:
+            setupHorse(top, bottom);
+            break;
+        // PandaSpigot end
         }
     }
 
@@ -277,6 +299,46 @@ public class CraftContainer extends Container {
         // End copy from ContainerBrewingStand
     }
 
+    // PandaSpigot start - Fix custom inventories
+    private void setupBeacon(IInventory top, IInventory bottom) {
+        // This code copied from ContainerBeacon
+        this.a(new Slot(top, 0, 136, 110));
+        short short0 = 137;
+
+        int i;
+
+        for (i = 0; i < 3; ++i) {
+            for (int j = 0; j < 9; ++j) {
+                this.a(new Slot(bottom, j + i * 9 + 9, b0 + j * 18, short0 + i * 18));
+            }
+        }
+
+        for (i = 0; i < 9; ++i) {
+            this.a(new Slot(bottom, i, b0 + i * 18, 58 + short0));
+        }
+    }
+
+    private void setupAnvil(IInventory top, IInventory bottom) {
+        // This code copied from ContainerAnvil
+
+        this.a(new Slot(top, 0, 27, 47));
+        this.a(new Slot(top, 1, 76, 47));
+        this.a(new Slot(top, 2, 134, 47));
+
+        int i;
+
+         for (i = 0; i < 3; ++i) {
+            for (int j = 0; j < 9; ++j) {
+                this.a(new Slot(bottom, j + i * 9 + 9, 8 + j * 18, 84 + i * 18));
+            }
+        }
+
+        for (i = 0; i < 9; ++i) {
+            this.a(new Slot(bottom, i, 8 + i * 18, 142));
+        }
+    }
+    // PandaSpigot end
+
     private void setupHopper(IInventory top, IInventory bottom) {
         // This code copied from ContainerHopper
         byte b0 = 51;
@@ -299,6 +361,32 @@ public class CraftContainer extends Container {
         // End copy from ContainerHopper
     }
 
+    // PandaSpigot start - Fix custom inventories
+    private void setupMerchant(IInventory top, IInventory botoom) {
+        // This code copied from ContainerMerchant
+
+        this.a(new Slot(top, 0, 36, 53));
+        this.a(new Slot(top, 1, 62, 53));
+        this.a(new Slot(top, 2, 120, 53));
+
+        int i;
+
+        for (i = 0; i < 3; ++i) {
+            for (int j = 0; j < 9; ++j) {
+                this.a(new Slot(bottom, j + i * 9 + 9, 8 + j * 18, 84 + i * 18));
+            }
+        }
+
+        for (i = 0; i < 9; ++i) {
+            this.a(new Slot(bottom, i, 8 + i * 18, 142));
+        }
+    }
+
+    private void setupHorse(IInventory top, IInventory bottom) {
+        
+    }
+    // PandaSpigot end
+
     public boolean a(EntityHuman entity) {
         return true;
     }
